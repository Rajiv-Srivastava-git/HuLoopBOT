using System.Diagnostics;

namespace HuLoopBOT.Utilities;

public static class Logger
{
    private static string path = @"C:\ProgramData\HuLoopBOT\log.txt";
    private const string EventSource = "HuLoopBOT";
    private const string EventLogName = "Application";
    
    // Configure whether verbose logging is enabled
    public static bool VerboseLoggingEnabled { get; set; } = true;

    static Logger()
    {
   // Ensure the event source is created (requires admin privileges)
        try
        {
            if (!EventLog.SourceExists(EventSource))
     {
                EventLog.CreateEventSource(EventSource, EventLogName);
  }
}
   catch (Exception ex)
    {
    // If we can't create the source, log to file only
         Directory.CreateDirectory(Path.GetDirectoryName(path)!);
  File.AppendAllText(path, $"{DateTime.Now}: Failed to create event source: {ex.Message}\n");
        }
    }

    public static void Log(string message)
    {
    LogInformation(message);
    }

    public static void LogInformation(string message)
    {
        LogToFile($"[INFO] {message}");
        LogToEventViewer(message, EventLogEntryType.Information, 1000);
    }

    public static void LogWarning(string message)
    {
        LogToFile($"[WARNING] {message}");
        LogToEventViewer(message, EventLogEntryType.Warning, 2000);
    }

    public static void LogError(string message, Exception? exception = null)
    {
        var fullMessage = exception != null 
         ? $"{message}\nException: {exception.Message}\nStackTrace: {exception.StackTrace}" 
   : message;
        
        LogToFile($"[ERROR] {fullMessage}");
     LogToEventViewer(fullMessage, EventLogEntryType.Error, 3000);
  }

    public static void LogVerbose(string message)
    {
        if (!VerboseLoggingEnabled)
    return;

        LogToFile($"[VERBOSE] {message}");
        LogToEventViewer(message, EventLogEntryType.Information, 1001);
 }

    public static void LogDebug(string message)
    {
        if (!VerboseLoggingEnabled)
       return;

        LogToFile($"[DEBUG] {message}");
LogToEventViewer(message, EventLogEntryType.Information, 1002);
  }

    private static void LogToFile(string message)
    {
        try
        {
         Directory.CreateDirectory(Path.GetDirectoryName(path)!);
 File.AppendAllText(path, $"{DateTime.Now:yyyy-MM-dd HH:mm:ss.fff}: {message}\n");
        }
   catch
        {
    // Silently fail if we can't write to file
        }
    }

    private static void LogToEventViewer(string message, EventLogEntryType entryType, int eventId)
    {
  try
   {
       if (EventLog.SourceExists(EventSource))
      {
     EventLog.WriteEntry(EventSource, message, entryType, eventId);
    }
        }
        catch
        {
// Silently fail if we can't write to event log
 }
    }
}
